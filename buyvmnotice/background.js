// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o;i=this;i.markid=localStorage.marknoticeid;i.followList=localStorage.followList?JSON.parse(localStorage.followList):!1;i.onUrl="http://buyvmnotice.sinaapp.com/on.html";i.offUrl="http://buyvmnotice.sinaapp.com/off.html";i.apiUrl="http://buyvmnotice.sinaapp.com/buyvmapi.php";i.fullapiUrl="http://buyvmnotice.sinaapp.com/buyvmfullapi.php";r=function(e){var t;if(e.stock){t="IN STOCK: "+e.total;return chrome.bookmarks.update(i.markid,{title:t,url:i.onUrl})}t="Out of Stock";return chrome.bookmarks.update(i.markid,{title:t,url:i.offUrl})};s=function(e){var t,n,s,o,u;s=0;for(o=0,u=e.length;o<u;o++){t=e[o];t.qty>0&&i.followList[t.pid]&&(s+=t.qty)}n=s>0;return r({total:s,stock:n})};e=function(){var e;e=new XMLHttpRequest;e.open("GET",i.apiUrl,!0);e.onreadystatechange=function(){if(e.readyState===4)return r(JSON.parse(e.responseText))};return e.send()};t=function(){var e;e=new XMLHttpRequest;e.open("GET",i.fullapiUrl,!0);e.onreadystatechange=function(){if(e.readyState===4)return s(JSON.parse(e.responseText))};return e.send()};n=function(){var t;t={title:"Buyvm Marknotice",url:i.offUrl};return chrome.bookmarks.create(t,function(t){localStorage.marknoticeid=i.markid=t.id;e();return chrome.tabs.create({url:chrome.extension.getURL("/assets/intro.html")})})};o=function(){i.markid?chrome.bookmarks.get(i.markid,function(e){if(!e){localStorage.removeItem(i.markid);return n()}}):n();return i.followList?setInterval(t,6e4):setInterval(e,6e4)};addEventListener("load",o,!1)}).call(this);