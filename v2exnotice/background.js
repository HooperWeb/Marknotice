// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s;r=this;r.markid=localStorage.marknoticeid;r.url="http://v2ex.com/";r.noticeUrl="http://v2ex.com/notifications";r.apiUrl="http://v2ex.com/faq";n=function(e){var t,n,i;t=0;e&&(t=parseInt(e[1]));if(t>0){n="V2EX ("+t+")";i=r.noticeUrl;return chrome.bookmarks.update(r.markid,{title:n,url:i})}n="V2EX";i=r.url;return chrome.bookmarks.update(r.markid,{title:n,url:i})};i=function(){var e;e=new XMLHttpRequest;e.open("GET",r.apiUrl,!0);e.onreadystatechange=function(){if(e.readyState===4)return n(e.responseText.match(/FAQ\s\((.*)\)<\/title>/))};return e.send()};e=function(){return chrome.bookmarks.search("V2EX",function(e){return e[0]?localStorage.marknoticeid=r.markid=e[0].id:t()})};t=function(){var e;e={title:"V2EX",url:r.url};chrome.bookmarks.create(e,function(e){localStorage.marknoticeid=r.markid=e.id;return i()});return chrome.tabs.create({url:chrome.extension.getURL("/assets/intro.html")})};s=function(){r.markid?chrome.bookmarks.get(r.markid,function(t){if(!t){localStorage.removeItem(r.markid);return e()}}):e();return setInterval(i,9e4)};addEventListener("load",s,!1);chrome.tabs.onUpdated.addListener(function(e,t){console.log(t);if(t.url&&t.url===r.noticeUrl)return chrome.bookmarks.get(r.markid,function(e){var t,n;if(e[0].url===r.noticeUrl){t="V2EX";n=r.url;return chrome.bookmarks.update(r.markid,{title:t,url:n})}})})}).call(this);